# Lazy Adapters

---

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –Ω–∞ C++ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏, –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –∏ —Ñ–∞–π–ª–∞–º–∏.

---

## ‚≠ê –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Pipeline
* –ú–Ω–æ–≥–æ–æ–±—Ä–∞–∑–∏–µ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –∏ –∏—Ö –≥–∏–±–∫–æ—Å—Ç—å
* –õ–µ–Ω–∏–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ Pipeline'–æ–≤ (–∫—Ä–æ–º–µ `AggregateByKey`)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `const` —Ç–∏–ø–æ–≤
* –ê–¥–∞–ø—Ç–µ—Ä—ã **–Ω–µ –≤–ª–∞–¥–µ—é—Ç** –º–∞—Å—Å–∏–≤–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
* –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∑–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –ø–æ –ø–∞–º—è—Ç–∏ (–∫—Ä–æ–º–µ `AggregateByKey` –∏ `Join`)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `range-based for`

---

## üìö API Reference

* Dir       - –±–µ—Ä–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø–æ –≤—Å–µ–º –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º)
* OpenFiles - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª–æ–≤—ã–π –ø–æ—Ç–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞
* Split      - –¥–µ–ª–∏—Ç –≤—Ö–æ–¥–Ω–æ–π –ø–æ—Ç–æ–∫ –ø–æ —Å–ø–∏—Å–∫—É –¥–µ–ª–∏–º–∏—Ç–µ—Ä–æ–≤ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
* Out       - –≤—ã–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π –ø–æ—Ç–æ–∫
* AsDataFlow - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
* Transform - –∏–∑–º–µ–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –Ω–∞–ø–æ–¥–æ–±–∏–µ —Ç–æ–≥–æ –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º transform, –ø—Ä–∏–º–µ–Ω—è—è –∑–∞–¥–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
* Filter    - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É, –ø—Ä–∏–∑–Ω–∞–∫ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
* Write     - –ø—Ä–æ—Ö–æ–¥–∏—Ç—Å—è –ø–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –≤—Ö–æ–¥–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏ –∑–∞–ø–∏—Å–∞—Ç—å –∏—Ö –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—ã–≤–æ–¥–∞, –≤—Å—Ç–∞–≤–ª—è—è –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (–∞ —Ç–∞–∫–∂–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞) –∑–∞–¥–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å.
* AsVector  - —Å–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –≤–µ–∫—Ç–æ—Ä
* Join      - –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–ª—é—á—É, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ LEFT JOIN –≤ SQL
* KV        - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
* JoinResult - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–±–æ–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
* DropNullopt - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç `std::optional<T>` –ø–æ—Ç–æ–∫ –æ—Ç `std::nullopt` –∑–Ω–∞—á–µ–Ω–∏–π
* SplitExpected - –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–¥–∞–ø—Ç–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç expected, –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ 2 –¥–ª—è –æ–∂–∏–¥–∞–µ–º—ã—Ö –∏ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
* AggregateByKey - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª—é—á–∞. –ó–Ω–∞—á–µ–Ω–∏–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –∫–ª—é—á—É, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç - –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–Ω–µ –ª–µ–Ω–∏–≤–æ** 
    * –ü—Ä–∏–º–µ—Ä:
        ```cpp
        std::vector<char> input = {'a', 'b', 'c', 'd', 'a', 'a', 'b', 'd'};

        auto result = AsDataFlow(input)
            | AggregateByKey(
                std::size_t{0},
                [](const char&, std::size_t& acc) { ++acc;},
                [](const char& ch) { return ch;}
            )
            | AsVector();
        [ a, b, c, d, a, a, b, d ] -> [ (a, 3), (b, 2), (c,1), (d,2) ]
        ```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ù–∏–∂–µ –±—É–¥—É—Ç –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

### –ó–∞–¥–∞—á–∞

–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏ —Å–ª–æ–≤ –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –≤—ã–≤–µ—Å—Ç–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ø–æ—Ç–æ–∫ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞

### –í–æ–∑–º–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```cpp
#include <iostream>

#include <processing.h>

int main(int argc, char **argv) {
  if (argc != 2) {
    return 0;
  }
  
  Dir(argv[1], true) 
    | Filter([](std::filesystem::path& p){ return p.extension() == ".txt"; })
    | OpenFiles()
    | Split("\n ,.;")
    | Transform(
        [](std::string& token) { 
            std::transform(token.begin(), token.end(), token.begin(), [](char c){return std::tolower(c);});
            return token;
        })
    | AggregateByKey(
        std::size_t{0}, 
        [](const std::string&, size_t& count) { ++count;},
        [](const std::string& token) { return token;}
      )
    | Transform([](const std::pair<std::string, size_t>& stat) { return std::format("{} - {}", stat.first, stat.second);})
    | Out(std::cout);
  
  return 0;
}
```

### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è PipeLine

```cpp

std::vector<std::string> input = {"name4", "name0", "name1", "name0", "name2", "name0", "name1"};

auto result =
    AsDataFlow(input)
        | AggregateByKey(
            std::size_t{0},
            [](const std::string&, std::size_t& accumulated) { ++accumulated; },
            [](const std::string& token) { return token; }
        )
        | AsVector();
```

---

## üîÅ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —É—Ç–∏–ª–∏—Ç—ã

–î–ª—è —Å–±–æ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `CMake` –æ—Ç –≤–µ—Ä—Å–∏–∏ `3.12` –∏ `Cpp Standart 23`

–ü—Ä–∏–º–µ—Ä —Å–±–æ—Ä–∫–∏:
```bash
mkdir build
cd build
cmake ..
cmake --build .
```
